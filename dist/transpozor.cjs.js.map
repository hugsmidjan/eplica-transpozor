{"version":3,"file":"transpozor.cjs.js","sources":["../src/transpozor.js"],"sourcesContent":["let transpozor;\nconst plugins = [];\nconst pluginsById = {};\nconst widgets = [];\n\nconst events = {\n  start: [],\n  end: [],\n};\n\n// Element#matches normalization.\nconst ep = Element.prototype;\nep.is = ep.matches || ep.msMatchesSelector || ep.webkitMatchesSelector;\n\n\n\nconst E = (tagName, attrs, ...children) => {\n  const elm = document.createElement(tagName);\n  if (attrs) {\n    for (let name in attrs) {\n      const value = attrs[name];\n      if ( value != null ) {\n        if ( (/^on[A-Z]/).test(name) ) {\n          elm.addEventListener(name.substr(2).toLowerCase(), value);\n        }\n        else if ( name.charAt(0) === '_' ) {\n          elm[name.substr(1)] = value;\n        }\n        else {\n          elm.setAttribute(name, value);\n        }\n      }\n    }\n  }\n  children.forEach((child) => {\n    if ( typeof child === 'string' ) {\n      child = document.createTextNode( child );\n    }\n    elm.appendChild( child );\n  });\n  return elm;\n};\n\nconst $ = (selector, elm) =>  !selector ? [] : [].slice.call( (elm||document).querySelectorAll(selector) );\n\n\n\n\nconst makeWidgetToolbar = (widget, actions) => {\n  const wrapperElm = widget.wrapperElm;\n  const removeBtn = E('button', {\n                      'data-transpozor-button': 'remove',\n                      onClick: (/*e*/) => {\n                        const cancelledByWidget = widget.onRemove && widget.onRemove();\n                        if ( cancelledByWidget != null ? cancelledByWidget : confirm('Remove Widget!?') ) {\n                          actions.remove();\n                          wrapperElm.parentNode.removeChild( wrapperElm );\n                          const pos = widgets.indexOf( widget );\n                          widgets.splice( pos, 1);\n                        }\n                      },\n                      title: 'Remove',\n                    }, 'X');\n  const moveupBtn = E('button', {\n                      'data-transpozor-button': 'moveup',\n                      onClick: (/*e*/) => {\n                        let prevElm = wrapperElm.previousElementSibling;\n                        if ( prevElm ) {\n                          wrapperElm.parentNode.insertBefore(wrapperElm, prevElm);\n                          moveupBtn.disabled = !wrapperElm.previousSibling;\n                          movedownBtn.disabled = !wrapperElm.nextSibling;\n                        }\n                      },\n                      _disabled: !wrapperElm.previousSibling,\n                      title: 'Move Up',\n                    }, '↑');\n  const movedownBtn = E('button', {\n                      'data-transpozor-button': 'movedown',\n                      onClick: (/*e*/) => {\n                        let nextElm = wrapperElm.nextElementSibling;\n                        if ( nextElm ) {\n                          wrapperElm.parentNode.insertBefore(wrapperElm, nextElm.nextSibling);\n                          moveupBtn.disabled = !wrapperElm.previousSibling;\n                          movedownBtn.disabled = !wrapperElm.nextSibling;\n                        }\n                      },\n                      _disabled: !wrapperElm.nextSibling,\n                      title: 'Move Down',\n                    }, '↓');\n\n  let relax;\n  const highlight = () => {\n    clearTimeout(relax);\n    relax = setTimeout(() => {\n      wrapperElm.setAttribute('data-transpozor-wrapper-active','');\n    }, 100);\n  };\n  const deHighlight = () => {\n    clearTimeout(relax);\n    relax = setTimeout(() => {\n      wrapperElm.removeAttribute('data-transpozor-wrapper-active');\n    }, 100);\n  };\n\n  return  E('div', {\n              'data-transpozor-toolbar': '',\n              lang: 'en',\n              onFocusin: highlight,\n              onMouseenter: highlight,\n              onFocusout: deHighlight,\n              onMouseleave: deHighlight,\n            },\n            moveupBtn,\n            movedownBtn,\n            removeBtn\n          );\n};\n\n\n\nconst defaultParseData = (elm) => JSON.parse( elm.getAttribute('data-transpozor') ) || {};\n\n\nconst createWidget = (plugin, elm, editElm, isInserting) => {\n  const data = (plugin.parseData||defaultParseData)(elm, editElm, isInserting);\n\n  // Add class=\".\" to sidestep Inline Editor's \"Class-/ID-less <div> and <span> cleanup\" phase\n  const containerElm = E('div', { class:'.', 'data-transpozor-container':'' });\n  const wrapperElm = E('div', { class:'.', 'data-transpozor-wrapper':'' }, containerElm);\n\n  wrapperElm.addEventListener('paste', (e) => {\n    if ( e.target.is('input, textarea') ) {\n      e.stopPropagation();\n    }\n    else {\n      // Problem:\n      // The inline-editor seems to always inject HTML into the current\n      // selectionRange with an offset relative to the editElm –\n      // not taking into account the possibility that contentEditable elements\n      // might be nested.\n      //\n      // Solution:\n      // Before a paste event reaches the editElm's special paste event-handler\n      // turn off the contentEditable lock/scoping for just long enough\n      // for the paste event (and it's behind the scenes capture, cleanup etc.)\n      // to run its course and the inline-editor to inject the pasted content\n      // into place.\n      wrapperElm.contentEditable = true;\n      setTimeout(()=>{ wrapperElm.contentEditable = false; }, 500);\n    }\n  }, true);\n  // Problem:\n  // Similar as with the paste event above.\n  // Inline-editor toolbar actions/buttons inject HTML snippets\n  // into the editElm and fail if the current selectionRange\n  // (caret position) is inside a nested contedEditable element.\n  //\n  // Solution:\n  // Toolbar clicks inherently blur the editElm so we make the\n  // contentEditable lock/scoping off-by-default and only\n  // turn it on while editElm has focus.\n  const isExternallySourced = (e) => {\n    return  (\n      !e.relatedTarget ||\n      ( !e.relatedTarget.contains(e.target) &&\n        !e.target.contains(e.relatedTarget)\n      )\n    );\n  };\n  const lockWrapperElm = (e) => {\n    if (wrapperElm.contedEditable !== 'false' && isExternallySourced(e) ) {\n      wrapperElm.contentEditable = false;\n    }\n  };\n  const unlockWrapperElm = (e) => {\n    if (wrapperElm.contedEditable !== 'true' && isExternallySourced(e) ) {\n      wrapperElm.contentEditable = true;\n    }\n  };\n  // Preempt the focus event when user enters the wrapper directly –\n  // because otherwise flipping the contenteditable switch causes an\n  // instant blur on editElm and no re-focus on the nested\n  // contendEditable element.\n  wrapperElm.addEventListener('mousedown', lockWrapperElm, true);\n  wrapperElm.addEventListener('touchstart', lockWrapperElm, true);\n  // NOTE: Using the capture-phase is neccessary because\n  // blur/focus events don't bubble from a nested focusable\n  // up to a containing focusable.\n  // (i.e. from nested HTML editable up to editElm)\n  editElm.addEventListener('focus', lockWrapperElm, true);\n  editElm.addEventListener('blur', unlockWrapperElm, true);\n\n  // // Do not default to contentEditable locking/scoping by default.\n  // // Instead rely on focus/blur handlers above.\n  // wrapperElm.contentEditable = false;\n\n  elm.parentNode.replaceChild(wrapperElm, elm);\n  const newWidget = new plugin({\n    data: data,\n    rootElm: containerElm,\n    editElm: editElm,\n    /* DEPRICATED */wrapperElm: containerElm,\n  });\n  newWidget.wrapperElm = wrapperElm;\n\n  const toolbar = makeWidgetToolbar(newWidget, {\n    remove: () => {\n      editElm.removeEventListener('focus', lockWrapperElm, true);\n      editElm.removeEventListener('blur', unlockWrapperElm, true);\n    },\n  });\n  wrapperElm.appendChild( toolbar );\n\n  widgets.push( newWidget );\n};\n\n\n\n// When the user injects one or more new/empty widgets\n// into an editElm, this function gets called to initialize the\n// inserted empty widget-markers.\nconst scanForInsertMarkers = () => {\n  // HTML-Snippet (Greinaklippur) example:\n  //     <img data-transpozor-insert=\"pluginId\" onload=\"EPLICA.inlineEditor.transpozor.rescan()\" src=\"https://eplica-cdn.is/f/e2-w.png\" />\n  //\n  // JavaScript injection example:\n  //     const widgetMarker = document.createElement('div');\n  //     widgetMarker.setAttribute('data-transpozor-insert', 'pluginId');\n  //     editElm.appendChild( widgetMarker );\n  //     transpozor.rescan();\n  //\n  $('[data-transpozor-insert]').forEach((placeholderElm) => {\n    const type = placeholderElm.getAttribute('data-transpozor-insert');\n    const plugin = pluginsById[type];\n    if ( plugin ) {\n      let editElm = placeholderElm.parentNode;\n      let nonEditElmParent;\n      while (editElm && !editElm.is('.EPLICA_editzone')) {\n        nonEditElmParent = editElm;\n        editElm = editElm.parentNode;\n      }\n      if ( editElm ) {\n        const insert = plugin.validateInsertion && plugin.validateInsertion( placeholderElm, editElm );\n        if ( insert === false ) {\n          placeholderElm.parentNode.removeChild( placeholderElm );\n        }\n        else {\n          if ( !plugin.validateInsertion && nonEditElmParent ) {\n            editElm.insertBefore( placeholderElm, nonEditElmParent.nextSibling );\n          }\n          createWidget(plugin, placeholderElm, editElm, true);\n        }\n      }\n    }\n  });\n};\n\n\n\nlet _registered;\nconst registerWithEditor = (editor) => {\n  if ( !_registered ) {\n    _registered = true;\n\n    editor = editor || window.EPLICA.inlineEditor;\n\n    // Expose transpozor as part of the Eplica inlineEditor.\n    editor.transpozor = transpozor;\n\n    let _pluginSelectors;\n    const pluginSelectors = () => {\n      if ( _pluginSelectors === undefined ) {\n        _pluginSelectors = plugins\n            .map((plugin) => plugin.selector)\n            .join(', ');\n      }\n      return _pluginSelectors;\n    };\n\n    editor.addEvent('EditorOpen', (e) => {\n      const editElms = e.editElms;\n      // Something in the Editor activation process messes with\n      // event-handlers and dynamic behaviours set by the plugins -\n      // so we need to wait for it to finish before initing\n      setTimeout(() => {\n        editElms.forEach((editElm) => {\n          if ( editElm.getAttribute('entrytype') === 'html' ) {\n            events.start.forEach((handler) => {\n              handler({\n                editElm: editElm,\n                transposeElms: $(pluginSelectors(), editElm),\n                // transposeSelectors: pluginSelectors(),\n              });\n            });\n            plugins.forEach((plugin) => {\n              $(plugin.selector, editElm).forEach((elm) => {\n                createWidget(plugin, elm, editElm);\n              });\n            });\n          }\n        });\n        scanForInsertMarkers();\n      }, 0);\n    });\n\n\n    // Allow opting in to using 'SaveStart' event - to support older (<4.1.3) EPLICA versions.\n    const saveEvent = transpozor.undocumented_option_useSaveStartEvent ? 'SaveStart' : 'Save';\n\n    editor.addEvent(saveEvent, (e) => {\n      const editElm = e.target;\n      if ( e.targetType === 'html' ) {\n        // Signal to all widgets to re-render as static HTML\n        const widgetToHtmlReturns = [];\n        widgets.slice().forEach((widget, i) => {\n        // const widgetToHtmlReturns = widgets.slice().map((widget, i) => {\n          let widgetEditElm = widget.editElm;\n          if ( !widgetEditElm ) {\n            widgetEditElm = widget.wrapperElm;\n            while ( widgetEditElm && !widgetEditElm.is('.EPLICA_editzone') ) {\n              widgetEditElm = widgetEditElm.parentNode;\n            }\n          }\n          if ( widgetEditElm === editElm ) {\n            widgets.splice(i,1);\n            // return widget.toHTML();\n            const ret = widget.toHTML();\n            if ( ret && ret.then ) {\n              widgetToHtmlReturns.push(ret);\n            }\n          }\n        });\n        const zapWrappersAndEmitEnd = () => {\n          // Zap wrappers\n          $('[data-transpozor-container]', editElm).forEach((container) => {\n            const wrapper = container.parentNode;\n            const parent = wrapper.parentNode;\n            while ( container.firstChild ) {\n              parent.insertBefore(container.firstChild, wrapper);\n            }\n            parent.removeChild(wrapper);\n          });\n          events.end.forEach((handler) => {\n            handler({\n              editElm: editElm,\n              transposeElms: $(pluginSelectors(), editElm),\n              // transposeSelectors: pluginSelectors(),\n            });\n          });\n          return; // explicitly return undefined.\n        };\n        // Maintain backwards compatibility with Eplica versions (<4.1.4)\n        // by only return a promise if the widgets return promises\n        if ( widgetToHtmlReturns.length ) {\n          return Promise.all( widgetToHtmlReturns )\n              .then( zapWrappersAndEmitEnd );\n        }\n        // FIXME: Always return a promise when all eplica-transpozor using websites\n        // have been updated to a newer (promise-supporting editor) version of Eplica.\n        zapWrappersAndEmitEnd();\n      }\n    });\n\n  }\n  return transpozor;\n};\n\nconst addPlugin = (plugin) => {\n  registerWithEditor(); // safe to run multiple times\n  plugins.push(plugin);\n  pluginsById[ plugin.id ] = plugin;\n  return transpozor;\n};\n\nconst addEvent = (type, handler) => {\n  events[type].push(handler);\n  return transpozor;\n};\n\n\ntranspozor = {\n  addPlugin: addPlugin,\n  on: addEvent,\n  registerWithEditor: registerWithEditor,\n\n  rescan: scanForInsertMarkers,\n};\n\n\nexport default transpozor;\n"],"names":["let","const"],"mappings":"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"}