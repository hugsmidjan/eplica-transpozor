{"version":3,"file":"transpozor.cjs.js","sources":["../src/transpozor.js"],"sourcesContent":["let transpozor;\nconst plugins = [];\nconst pluginsById = {};\nconst widgets = [];\n\nconst events = {\n  start: [],\n  end: [],\n};\n\n// Element#matches normalization.\nconst ep = Element.prototype;\nep.is = ep.matches || ep.msMatchesSelector || ep.webkitMatchesSelector;\n\n\n\nconst E = function (tagName, attrs) {\n  const elm = document.createElement(tagName);\n  if (attrs) {\n    for (let name in attrs) {\n      elm.setAttribute(name, attrs[name]);\n    }\n  }\n  if ( arguments.length > 2 ) {\n    const children = [].slice.call(arguments, 2);\n    children.forEach(child => {\n      if ( typeof child === 'string' ) {\n        child = document.createTextNode( child );\n      }\n      elm.appendChild( child );\n    });\n  }\n  return elm;\n};\n\nconst $ = function (selector, elm) {\n  return !selector ? [] : [].slice.call( (elm||document).querySelectorAll(selector) );\n};\n\n\n\n\nconst makeWidgetToolbar = function ( widget, wrapperElm, actions) {\n  const removeBtn = E('button', { 'data-transpozor-button': 'remove', title: 'Remove' }, 'X');\n  removeBtn.addEventListener('click', function(){\n    const cancelledByWidget = widget.onRemove && widget.onRemove();\n    if ( cancelledByWidget != null ? cancelledByWidget : confirm('Remove Widget!?') ) {\n      actions.remove();\n      wrapperElm.parentNode.removeChild( wrapperElm );\n      const pos = widgets.indexOf( widget );\n      widgets.splice( pos, 1);\n    }\n  });\n\n  let relax;\n  const highlight = function () {\n    clearTimeout(relax);\n    relax = setTimeout(function () {\n      wrapperElm.setAttribute('data-transpozor-wrapper-active','');\n    }, 100);\n  }\n  const deHighlight = function () {\n    clearTimeout(relax);\n    relax = setTimeout(function () {\n      wrapperElm.removeAttribute('data-transpozor-wrapper-active');\n    }, 100);\n  }\n\n  const toolbar = E('div', {\n                    'data-transpozor-toolbar': '',\n                    lang: 'en',\n                  },\n                  removeBtn\n                );\n  toolbar.addEventListener('focusin', highlight);\n  toolbar.addEventListener('mouseenter', highlight);\n  toolbar.addEventListener('focusout', deHighlight);\n  toolbar.addEventListener('mouseleave', deHighlight);\n\n  return toolbar;\n};\n\n\n\nconst defaultParseData = function (elm) {\n  return JSON.parse( elm.getAttribute('data-transpozor') ) || {};\n};\n\nconst createWidget = function (plugin, elm, editElm, isInserting) {\n  const data = (plugin.parseData||defaultParseData)(elm, editElm, isInserting);\n\n  const containerElm = E('div', { 'data-transpozor-container':'' });\n  const wrapperElm = E('div', { 'data-transpozor-wrapper':'' }, containerElm);\n\n  wrapperElm.addEventListener('paste', function(e){\n    if ( e.target.is('input, textarea') ) {\n      e.stopPropagation();\n    }\n    else {\n      // Problem:\n      // The inline-editor seems to always inject HTML into the current\n      // selectionRange with an offset relative to the editElm –\n      // not taking into account the possibility that contentEditable elements\n      // might be nested.\n      //\n      // Solution:\n      // Before a paste event reaches the editElm's special paste event-handler\n      // turn off the contentEditable lock/scoping for just long enough\n      // for the paste event (and it's behind the scenes capture, cleanup etc.)\n      // to run its course and the inline-editor to inject the pasted content\n      // into place.\n      wrapperElm.contentEditable = true;\n      setTimeout(()=>{ wrapperElm.contentEditable = false; }, 500);\n    }\n  }, true);\n  // Problem:\n  // Similar as with the paste event above.\n  // Inline-editor toolbar actions/buttons inject HTML snippets\n  // into the editElm and fail if the current selectionRange\n  // (caret position) is inside a nested contedEditable element.\n  //\n  // Solution:\n  // Toolbar clicks inherently blur the editElm so we make the\n  // contentEditable lock/scoping off-by-default and only\n  // turn it on while editElm has focus.\n  const isExternallySourced = function (e) {\n    return  (\n      !e.relatedTarget ||\n      ( !e.relatedTarget.contains(e.target) &&\n        !e.target.contains(e.relatedTarget)\n      )\n    );\n  };\n  const lockWrapperElm = function(e){\n    if (wrapperElm.contedEditable !== 'false' && isExternallySourced(e) ) {\n      wrapperElm.contentEditable = false;\n    }\n  };\n  const unlockWrapperElm = function(e){\n    if (wrapperElm.contedEditable !== 'true' && isExternallySourced(e) ) {\n      wrapperElm.contentEditable = true;\n    }\n  };\n  // Preempt the focus event when user enters the wrapper directly –\n  // because otherwise flipping the contenteditable switch causes an\n  // instant blur on editElm and no re-focus on the nested\n  // contendEditable element.\n  wrapperElm.addEventListener('mousedown', lockWrapperElm, true);\n  wrapperElm.addEventListener('touchstart', lockWrapperElm, true);\n  // NOTE: Using the capture-phase is neccessary because\n  // blur/focus events don't bubble from a nested focusable\n  // up to a containing focusable.\n  // (i.e. from nested HTML editable up to editElm)\n  editElm.addEventListener('focus', lockWrapperElm, true);\n  editElm.addEventListener('blur', unlockWrapperElm, true);\n\n  // // Do not default to contentEditable locking/scoping by default.\n  // // Instead rely on focus/blur handlers above.\n  // wrapperElm.contentEditable = false;\n\n  elm.parentNode.replaceChild(wrapperElm, elm);\n  const newWidget = new plugin({\n    data: data,\n    rootElm: containerElm,\n    editElm: editElm,\n    /* DEPRICATED */wrapperElm: containerElm,\n  });\n\n  const toolbar = makeWidgetToolbar(newWidget, wrapperElm, {\n    remove: () => {\n      editElm.removeEventListener('focus', lockWrapperElm, true);\n      editElm.removeEventListener('blur', unlockWrapperElm, true);\n    },\n  });\n  wrapperElm.appendChild( toolbar );\n\n  widgets.push( newWidget );\n};\n\n\n\n// When the user injects one or more new/empty widgets\n// into an editElm, this function gets called to initialize the\n// inserted empty widget-markers.\nconst scanForInsertMarkers = function () {\n  // HTML-Snippet (Greinaklippur) example:\n  //     <img data-transpozor-insert=\"pluginId\" onload=\"EPLICA.inlineEditor.transpozor.rescan()\" src=\"https://eplica-cdn.is/f/e2-w.png\" />\n  //\n  // JavaScript injection example:\n  //     const widgetMarker = document.createElement('div');\n  //     widgetMarker.setAttribute('data-transpozor-insert', 'pluginId');\n  //     editElm.appendChild( widgetMarker );\n  //     transpozor.rescan();\n  //\n  $('[data-transpozor-insert]').forEach(function (placeholderElm) {\n    const type = placeholderElm.getAttribute('data-transpozor-insert');\n    const plugin = pluginsById[type];\n    if ( plugin ) {\n      let editElm = placeholderElm.parentNode;\n      let nonEditElmParent;\n      while (editElm && !editElm.is('.EPLICA_editzone')) {\n        nonEditElmParent = editElm;\n        editElm = editElm.parentNode;\n      }\n      if ( editElm ) {\n        const insert = plugin.validateInsertion && plugin.validateInsertion( placeholderElm, editElm );\n        if ( insert === false ) {\n          placeholderElm.parentNode.removeChild( placeholderElm );\n        }\n        else {\n          if ( !plugin.validateInsertion && nonEditElmParent ) {\n            editElm.insertBefore( placeholderElm, nonEditElmParent.nextSibling );\n          }\n          createWidget(plugin, placeholderElm, editElm, true);\n        }\n      }\n    }\n  });\n};\n\n\n\nlet _registered;\nconst registerWithEditor = function (editor) {\n  if ( !_registered ) {\n    _registered = true;\n\n    editor = editor || window.EPLICA.inlineEditor;\n\n    // Expose transpozor as part of the Eplica inlineEditor.\n    editor.transpozor = transpozor;\n\n    let _pluginSelectors;\n    const pluginSelectors = function () {\n      if ( _pluginSelectors === undefined ) {\n        _pluginSelectors = plugins\n            .map(function (plugin) { return plugin.selector; })\n            .join(', ');\n      }\n      return _pluginSelectors;\n    };\n\n    editor.addEvent('EditorOpen', function (e) {\n      const editElms = e.editElms;\n      // Something in the Editor activation process messes with\n      // event-handlers and dynamic behaviours set by the plugins -\n      // so we need to wait for it to finish before initing\n      setTimeout(function() {\n        editElms.forEach(function (editElm) {\n          if ( editElm.getAttribute('entrytype') === 'html' ) {\n            events.start.forEach(function (handler) {\n              handler({\n                editElm: editElm,\n                transposeElms: $(pluginSelectors(), editElm),\n                // transposeSelectors: pluginSelectors(),\n              });\n            });\n            plugins.forEach(function (plugin) {\n              $(plugin.selector, editElm).forEach(function (elm) {\n                createWidget(plugin, elm, editElm);\n              });\n            });\n          }\n        });\n        scanForInsertMarkers();\n      }, 0);\n    });\n\n\n    editor.addEvent('SaveStart', function (e) {\n      const editElm = e.target;\n      if ( e.targetType === 'html' ) {\n        // Signal to all widgets to re-render as static HTML\n        widgets.forEach(function (widget) {\n          widget.toHTML();\n        });\n        // Zap wrappers\n        $('[data-transpozor-container]', editElm).forEach(container => {\n          const wrapper = container.parentNode;\n          const parent = wrapper.parentNode;\n          while ( container.firstChild ) {\n            parent.insertBefore(container.firstChild, wrapper);\n          }\n          parent.removeChild(wrapper);\n        });\n        events.end.forEach(function (handler) {\n          handler({\n            editElm: editElm,\n            transposeElms: $(pluginSelectors(), editElm),\n            // transposeSelectors: pluginSelectors(),\n          });\n        });\n      }\n    });\n\n  }\n  return transpozor;\n};\n\nconst addPlugin = function (plugin) {\n  registerWithEditor(); // safe to run multiple times\n  plugins.push(plugin);\n  pluginsById[ plugin.id ] = plugin;\n  return transpozor;\n};\n\nconst addEvent = function (type, handler) {\n  events[type].push(handler);\n  return transpozor;\n};\n\n\ntranspozor = {\n  addPlugin: addPlugin,\n  on: addEvent,\n  registerWithEditor: registerWithEditor,\n\n  rescan: scanForInsertMarkers,\n};\n\n\nexport default transpozor;\n"],"names":["let","const"],"mappings":"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"}