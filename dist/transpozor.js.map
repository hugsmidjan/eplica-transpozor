{"version":3,"file":"transpozor.js","sources":["../src/transpozor.js"],"sourcesContent":["let transpozor;\r\nconst plugins = [];\r\nconst pluginsById = {};\r\nconst widgets = [];\r\n\r\nconst events = {\r\n  start: [],\r\n  end: [],\r\n};\r\n\r\n// Element#matches normalization.\r\nconst ep = Element.prototype;\r\nep.is = ep.matches || ep.msMatchesSelector || ep.webkitMatchesSelector;\r\n\r\n\r\n\r\nconst E = (tagName, attrs, ...children) => {\r\n  const elm = document.createElement(tagName);\r\n  if (attrs) {\r\n    for (let name in attrs) {\r\n      const value = attrs[name];\r\n      if ( value != null ) {\r\n        if ( (/^on[A-Z]/).test(name) ) {\r\n          elm.addEventListener(name.substr(2).toLowerCase(), value);\r\n        }\r\n        else if ( name.charAt(0) === '_' ) {\r\n          elm[name.substr(1)] = value;\r\n        }\r\n        else {\r\n          elm.setAttribute(name, value);\r\n        }\r\n      }\r\n    }\r\n  }\r\n  children.forEach((child) => {\r\n    if ( typeof child === 'string' ) {\r\n      child = document.createTextNode( child );\r\n    }\r\n    elm.appendChild( child );\r\n  });\r\n  return elm;\r\n};\r\n\r\nconst $ = (selector, elm) =>  !selector ? [] : [].slice.call( (elm||document).querySelectorAll(selector) );\r\n\r\n\r\n\r\n\r\nconst makeWidgetToolbar = (widget, actions) => {\r\n  const wrapperElm = widget.wrapperElm;\r\n  const removeBtn = E('button', {\r\n                      'data-transpozor-button': 'remove',\r\n                      onClick: (/*e*/) => {\r\n                        const cancelledByWidget = widget.onRemove && widget.onRemove();\r\n                        if ( cancelledByWidget != null ? cancelledByWidget : confirm('Remove Widget!?') ) {\r\n                          actions.remove();\r\n                          wrapperElm.parentNode.removeChild( wrapperElm );\r\n                          const pos = widgets.indexOf( widget );\r\n                          widgets.splice( pos, 1);\r\n                        }\r\n                      },\r\n                      title: 'Remove',\r\n                    }, 'X');\r\n  const addSpace = E('button', {\r\n                      'data-transpozor-button': 'addspace',\r\n                      onClick: (/*e*/) => {\r\n                        wrapperElm.insertAdjacentText('afterend', 'a');\r\n                      },\r\n                      title: 'Add text after',\r\n                    }, '⎀');\r\n  const moveupBtn = E('button', {\r\n                      'data-transpozor-button': 'moveup',\r\n                      onClick: (/*e*/) => {\r\n                        let prevElm = wrapperElm.previousElementSibling;\r\n                        if ( prevElm ) {\r\n                          wrapperElm.parentNode.insertBefore(wrapperElm, prevElm);\r\n                          moveupBtn.disabled = !wrapperElm.previousSibling;\r\n                          movedownBtn.disabled = !wrapperElm.nextSibling;\r\n                        }\r\n                      },\r\n                      _disabled: !wrapperElm.previousSibling,\r\n                      title: 'Move Up',\r\n                    }, '↑');\r\n  const movedownBtn = E('button', {\r\n                      'data-transpozor-button': 'movedown',\r\n                      onClick: (/*e*/) => {\r\n                        let nextElm = wrapperElm.nextElementSibling;\r\n                        if ( nextElm ) {\r\n                          wrapperElm.parentNode.insertBefore(wrapperElm, nextElm.nextSibling);\r\n                          moveupBtn.disabled = !wrapperElm.previousSibling;\r\n                          movedownBtn.disabled = !wrapperElm.nextSibling;\r\n                        }\r\n                      },\r\n                      _disabled: !wrapperElm.nextSibling,\r\n                      title: 'Move Down',\r\n                    }, '↓');\r\n\r\n  let relax;\r\n  const highlight = () => {\r\n    clearTimeout(relax);\r\n    relax = setTimeout(() => {\r\n      wrapperElm.setAttribute('data-transpozor-wrapper-active','');\r\n    }, 100);\r\n  };\r\n  const deHighlight = () => {\r\n    clearTimeout(relax);\r\n    relax = setTimeout(() => {\r\n      wrapperElm.removeAttribute('data-transpozor-wrapper-active');\r\n    }, 100);\r\n  };\r\n\r\n  return  E('div', {\r\n              'data-transpozor-toolbar': '',\r\n              lang: 'en',\r\n              onFocusin: highlight,\r\n              onMouseenter: highlight,\r\n              onFocusout: deHighlight,\r\n              onMouseleave: deHighlight,\r\n            },\r\n            moveupBtn,\r\n            movedownBtn,\r\n            addSpace,\r\n            removeBtn\r\n          );\r\n};\r\n\r\n\r\n\r\nconst defaultParseData = (elm) => JSON.parse( elm.getAttribute('data-transpozor') ) || {};\r\n\r\n\r\nconst createWidget = (plugin, elm, editElm, isInserting) => {\r\n  const data = (plugin.parseData||defaultParseData)(elm, editElm, isInserting);\r\n\r\n  // Add class=\".\" to sidestep Inline Editor's \"Class-/ID-less <div> and <span> cleanup\" phase\r\n  const containerElm = E('div', { class:'.', 'data-transpozor-container':'' });\r\n  const wrapperElm = E('div', { class:'.', 'data-transpozor-wrapper':'' }, containerElm);\r\n\r\n  wrapperElm.addEventListener('paste', (e) => {\r\n    if ( e.target.is('input, textarea') ) {\r\n      e.stopPropagation();\r\n    }\r\n    else {\r\n      // Problem:\r\n      // The inline-editor seems to always inject HTML into the current\r\n      // selectionRange with an offset relative to the editElm –\r\n      // not taking into account the possibility that contentEditable elements\r\n      // might be nested.\r\n      //\r\n      // Solution:\r\n      // Before a paste event reaches the editElm's special paste event-handler\r\n      // turn off the contentEditable lock/scoping for just long enough\r\n      // for the paste event (and it's behind the scenes capture, cleanup etc.)\r\n      // to run its course and the inline-editor to inject the pasted content\r\n      // into place.\r\n      wrapperElm.contentEditable = true;\r\n      setTimeout(()=>{ wrapperElm.contentEditable = false; }, 500);\r\n    }\r\n  }, true);\r\n  // Problem:\r\n  // Similar as with the paste event above.\r\n  // Inline-editor toolbar actions/buttons inject HTML snippets\r\n  // into the editElm and fail if the current selectionRange\r\n  // (caret position) is inside a nested contedEditable element.\r\n  //\r\n  // Solution:\r\n  // Toolbar clicks inherently blur the editElm so we make the\r\n  // contentEditable lock/scoping off-by-default and only\r\n  // turn it on while editElm has focus.\r\n  const isExternallySourced = (e) => {\r\n    return  (\r\n      !e.relatedTarget ||\r\n      ( !e.relatedTarget.contains(e.target) &&\r\n        !e.target.contains(e.relatedTarget)\r\n      )\r\n    );\r\n  };\r\n  const lockWrapperElm = (e) => {\r\n    if (wrapperElm.contedEditable !== 'false' && isExternallySourced(e) ) {\r\n      wrapperElm.contentEditable = false;\r\n    }\r\n  };\r\n  const unlockWrapperElm = (e) => {\r\n    if (wrapperElm.contedEditable !== 'true' && isExternallySourced(e) ) {\r\n      wrapperElm.contentEditable = true;\r\n    }\r\n  };\r\n  // Preempt the focus event when user enters the wrapper directly –\r\n  // because otherwise flipping the contenteditable switch causes an\r\n  // instant blur on editElm and no re-focus on the nested\r\n  // contendEditable element.\r\n  wrapperElm.addEventListener('mousedown', lockWrapperElm, true);\r\n  wrapperElm.addEventListener('touchstart', lockWrapperElm, true);\r\n  // NOTE: Using the capture-phase is neccessary because\r\n  // blur/focus events don't bubble from a nested focusable\r\n  // up to a containing focusable.\r\n  // (i.e. from nested HTML editable up to editElm)\r\n  editElm.addEventListener('focus', lockWrapperElm, true);\r\n  editElm.addEventListener('blur', unlockWrapperElm, true);\r\n\r\n  // // Do not default to contentEditable locking/scoping by default.\r\n  // // Instead rely on focus/blur handlers above.\r\n  // wrapperElm.contentEditable = false;\r\n\r\n  elm.parentNode.replaceChild(wrapperElm, elm);\r\n  const newWidget = new plugin({\r\n    data: data,\r\n    rootElm: containerElm,\r\n    editElm: editElm,\r\n    /* DEPRICATED */wrapperElm: containerElm,\r\n  });\r\n  newWidget.wrapperElm = wrapperElm;\r\n\r\n  const toolbar = makeWidgetToolbar(newWidget, {\r\n    remove: () => {\r\n      editElm.removeEventListener('focus', lockWrapperElm, true);\r\n      editElm.removeEventListener('blur', unlockWrapperElm, true);\r\n    },\r\n  });\r\n  wrapperElm.appendChild( toolbar );\r\n\r\n  widgets.push( newWidget );\r\n\r\n  return newWidget;\r\n};\r\n\r\n\r\n\r\n// When the user injects one or more new/empty widgets\r\n// into an editElm, this function gets called to initialize the\r\n// inserted empty widget-markers.\r\nlet debouncedScan;\r\nconst scanForInsertMarkers = (opts) => {\r\n  // HTML-Snippet (Greinaklippur) example:\r\n  //     <img data-transpozor-insert=\"pluginId\" onload=\"EPLICA.inlineEditor.transpozor.rescan()\" src=\"https://eplica-cdn.is/f/e2-w.png\" />\r\n  //\r\n  // JavaScript injection example:\r\n  //     const widgetMarker = document.createElement('div');\r\n  //     widgetMarker.setAttribute('data-transpozor-insert', 'pluginId');\r\n  //     editElm.appendChild( widgetMarker );\r\n  //     transpozor.rescan();\r\n  //\r\n  opts = opts || {};\r\n  const delay = 'delay' in opts ? opts.delay : 10;\r\n  clearTimeout( debouncedScan );\r\n  debouncedScan = setTimeout(() => {\r\n    $('[data-transpozor-insert]').forEach((placeholderElm) => {\r\n      const type = placeholderElm.getAttribute('data-transpozor-insert');\r\n      const plugin = pluginsById[type];\r\n      if ( plugin ) {\r\n        let editElm = placeholderElm.parentNode;\r\n        let nonEditElmParent;\r\n        while (editElm && !editElm.is('.EPLICA_editzone')) {\r\n          // Ignore empty, auto-inserted <div/> containers\r\n          if ( editElm.nodeName !== 'DIV' || editElm.className ) {\r\n            nonEditElmParent = editElm;\r\n          }\r\n          editElm = editElm.parentNode;\r\n        }\r\n        if ( editElm ) {\r\n          const insert = plugin.validateInsertion && plugin.validateInsertion( placeholderElm, editElm );\r\n          if ( insert === false ) {\r\n            placeholderElm.parentNode.removeChild( placeholderElm );\r\n          }\r\n          else {\r\n            if ( nonEditElmParent && !plugin.validateInsertion ) {\r\n              nonEditElmParent.parentNode.insertBefore( placeholderElm, nonEditElmParent.nextSibling );\r\n            }\r\n            createWidget(plugin, placeholderElm, editElm, true);\r\n          }\r\n        }\r\n      }\r\n    });\r\n  }, delay);\r\n};\r\n\r\n\r\n\r\nlet _registered;\r\nlet eplicaWidgets = window.EPLICA.externalWidgetPairs || [];\r\nconst registerWithEditor = (editor) => {\r\n  if ( !_registered ) {\r\n    _registered = true;\r\n\r\n    editor = editor || window.EPLICA.inlineEditor;\r\n\r\n\r\n    // Expose transpozor as part of the Eplica inlineEditor.\r\n    editor.transpozor = transpozor;\r\n\r\n    let _pluginSelectors;\r\n    const pluginSelectors = () => {\r\n      if ( _pluginSelectors === undefined ) {\r\n        _pluginSelectors = plugins\r\n            .map((plugin) => plugin.selector)\r\n            .join(', ');\r\n      }\r\n      return _pluginSelectors;\r\n    };\r\n\r\n    editor.addEvent('EditorOpen', (e) => {\r\n      const editElms = e.editElms;\r\n      // Something in the Editor activation process messes with\r\n      // event-handlers and dynamic behaviours set by the plugins -\r\n      // so we need to wait for it to finish before initing\r\n      setTimeout(() => {\r\n        editElms.forEach((editElm) => {\r\n          if ( editElm.getAttribute('entrytype') === 'html' ) {\r\n            events.start.forEach((handler) => {\r\n              handler({\r\n                editElm: editElm,\r\n                transposeElms: $(pluginSelectors(), editElm),\r\n                // transposeSelectors: pluginSelectors(),\r\n              });\r\n            });\r\n            plugins.forEach((plugin) => {\r\n              $(plugin.selector, editElm).forEach((elm) => {\r\n                const widget = createWidget(plugin, elm, editElm);\r\n                eplicaWidgets.push([elm,widget]);\r\n              });\r\n            });\r\n          }\r\n        });\r\n        scanForInsertMarkers();\r\n      }, 0);\r\n    });\r\n\r\n\r\n    // Allow opting in to using 'SaveStart' event - to support older (<4.1.3) EPLICA versions.\r\n    const saveEvent = transpozor.undocumented_option_useSaveStartEvent ? 'SaveStart' : 'Save';\r\n\r\n    editor.addEvent(saveEvent, (e) => {\r\n      const editElm = e.target;\r\n      if ( e.targetType === 'html' ) {\r\n        // Signal to all widgets to re-render as static HTML\r\n        const widgetToHtmlReturns = [];\r\n        widgets.slice().forEach((widget, i) => {\r\n        // const widgetToHtmlReturns = widgets.slice().map((widget, i) => {\r\n          let widgetEditElm = widget.editElm;\r\n          if ( !widgetEditElm ) {\r\n            widgetEditElm = widget.wrapperElm;\r\n            while ( widgetEditElm && !widgetEditElm.is('.EPLICA_editzone') ) {\r\n              widgetEditElm = widgetEditElm.parentNode;\r\n            }\r\n          }\r\n          if ( widgetEditElm === editElm ) {\r\n            widgets.splice(i,1);\r\n            // return widget.toHTML();\r\n            const ret = widget.toHTML();\r\n            if ( ret && ret.then ) {\r\n              widgetToHtmlReturns.push(ret);\r\n            }\r\n          }\r\n        });\r\n        const zapWrappersAndEmitEnd = () => {\r\n          // Zap wrappers\r\n          $('[data-transpozor-container]', editElm).forEach((container) => {\r\n            const wrapper = container.parentNode;\r\n            const parent = wrapper.parentNode;\r\n            while ( container.firstChild ) {\r\n              parent.insertBefore(container.firstChild, wrapper);\r\n            }\r\n            parent.removeChild(wrapper);\r\n          });\r\n          events.end.forEach((handler) => {\r\n            handler({\r\n              editElm: editElm,\r\n              transposeElms: $(pluginSelectors(), editElm),\r\n              // transposeSelectors: pluginSelectors(),\r\n            });\r\n          });\r\n          return; // explicitly return undefined.\r\n        };\r\n        // Maintain backwards compatibility with Eplica versions (<4.1.4)\r\n        // by only return a promise if the widgets return promises\r\n        if ( widgetToHtmlReturns.length ) {\r\n          return Promise.all( widgetToHtmlReturns )\r\n              .then( zapWrappersAndEmitEnd );\r\n        }\r\n        // FIXME: Always return a promise when all eplica-transpozor using websites\r\n        // have been updated to a newer (promise-supporting editor) version of Eplica.\r\n        zapWrappersAndEmitEnd();\r\n      }\r\n    });\r\n\r\n  }\r\n  return transpozor;\r\n};\r\n\r\nconst addPlugin = (plugin) => {\r\n  registerWithEditor(); // safe to run multiple times\r\n  plugins.push(plugin);\r\n  pluginsById[ plugin.id ] = plugin;\r\n  return transpozor;\r\n};\r\n\r\nconst addEvent = (type, handler) => {\r\n  events[type].push(handler);\r\n  return transpozor;\r\n};\r\n\r\n\r\ntranspozor = {\r\n  addPlugin: addPlugin,\r\n  on: addEvent,\r\n  registerWithEditor: registerWithEditor,\r\n\r\n  rescan: scanForInsertMarkers,\r\n};\r\n\r\n\r\nexport default transpozor;\r\n"],"names":["let","const"],"mappings":"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"}